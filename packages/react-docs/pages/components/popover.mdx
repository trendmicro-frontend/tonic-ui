# Popover

`Popover` is a non-modal dialog that floats around a trigger. `Popover` is used to display contextual information to users, and should be paired with a clickable trigger element.

`Popover` is built on top of the [Popper.js](https://popper.js.org/) library, and is composed of the `Popper` component.

<carbon-ad></carbon-ad>

## Import

- `Popover`: The wrapper that provides props, state, and context to its children
- `PopoverTrigger`: Used to wrap the reference (or trigger) element
- `PopoverContent`: The popover itself
- `PopoverHeader`: The header of the popover
- `PopoverBody`: The body of the popover
- `PopoverFooter`: The footer of the popover

```js
import {
  Popover,
  PopoverTrigger,
  PopoverContent,
  PopoverHeader,
  PopoverBody,
  PopoverFooter,
} from '@tonic-ui/react';
```

## Usage

### Controlled and uncontrolled popovers

Pass `isOpen` to the `Popover` component to control the state of the popover.

```jsx
<Popover isOpen>
  <PopoverTrigger>
    <Button>Popover trigger</Button>
  </PopoverTrigger>
  <PopoverContent>
    <Text>This is a controlled popover</Text>
  </PopoverContent>
</Popover>
```

Set `defaultIsOpen` to `true` to have the popover open by default.

```jsx
<Popover defaultIsOpen>
  <PopoverTrigger>
    <Button>Popover trigger</Button>
  </PopoverTrigger>
  <PopoverContent>
    <Text>This is an uncontrolled popover</Text>
  </PopoverContent>
</Popover>
```

### Basic Usage

When using this component, ensure the children passed to `PopoverTrigger` is focusable. `Popover` should be accessible and should allow users to access it using the tab key on a keyboard.

**A11y:** When `Popover` opens, the focus status is sent to  `PopoverContent`. When `Popover` is closed, the focus status is returned to the trigger.

```jsx
<Popover>
  <PopoverTrigger>
    <Button>Trigger</Button>
  </PopoverTrigger>
  <PopoverContent>
    <PopoverHeader>Popover Header</PopoverHeader>
    <PopoverBody>Popover Body</PopoverBody>
  </PopoverContent>
</Popover>
```
### Focus an element when `Popover` opens

By default, the focus status is to sent to `PopoverContent` when `Popover` opens. You can send the focus status to a specific element when it opens by passing the `initialFocusRef` prop.

```jsx
function WalkthroughPopover() {
  const initialFocusRef = React.useRef();
  return (
    <Popover
      initialFocusRef={initialFocusRef}
    >
      <PopoverTrigger>
        <Link>Trigger</Link>
      </PopoverTrigger>
      <PopoverContent>
        <PopoverHeader>
          Popover Header
        </PopoverHeader>
        <PopoverBody>
          Lorem ipsum dolor sit amet, consectetur adicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
          <Input mt="3x" ref={initialFocusRef} placeholder="Placeholder text" />
        </PopoverBody>
        <PopoverFooter
          border="0"
          display="flex"
          alignItems="center"
          justifyContent="space-between"
        >
          <Link fontSize="sm">Learn more</Link>
          <Stack direction="row" spacing="2x">
            <Button variant="primary">Setup Email</Button>
            <Button variant="default">
              Next
            </Button>
          </Stack>
        </PopoverFooter>
      </PopoverContent>
    </Popover>
  );
}
```

### Accessing Internal state

Tonic UI provides access to two internal states:  `isOpen` and `onClose`. Use the render prop pattern to access the internal states.

```jsx
function InternalStateEx() {
  const initRef = React.useRef();
  return (
    <Popover
      initialFocusRef={initRef}
    >
    {({ isOpen, onClose }) => (
      <>
        <PopoverTrigger>
          <Button>Click to {isOpen ? "close" : "open"}</Button>
        </PopoverTrigger>
        <PopoverContent>
          <PopoverHeader>
            Popover Header
          </PopoverHeader>
          <PopoverBody>
            Lorem ipsum dolor sit amet, consectetur adicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
            <Input mt="3x" placeholder="Placeholder text" />
          </PopoverBody>
          <PopoverFooter
            border="0"
            display="flex"
            alignItems="center"
            justifyContent="space-between"
          >
            <Link fontSize="sm">Learn more</Link>
            <Stack direction="row" spacing="2x">
              <Button variant="primary">Submit</Button>
              <Button variant="default" onClick={onClose} ref={initRef}>
                Cancel
              </Button>
            </Stack>
          </PopoverFooter>
        </PopoverContent>
      </>
    )}
    </Popover>
  );
}
```

### Controlled Usage

You can control the opening and closing of `Popover` by passing the `isOpen` or `onClose` state.

If required, you can set `returnFocusOnClose` to `false` to prevent Popver from returning the focus status to the children of `PopoverTrigger`.

```jsx
function ControlledUsage() {
  const [isOpen, setIsOpen] = React.useState(false);
  const open = () => setIsOpen(!isOpen);
  const close = () => setIsOpen(false);
  return (
    <>
      <Button mr={5} onClick={open}>
        Trigger
      </Button>
      <Popover
        returnFocusOnClose={false}
        isOpen={isOpen}
        onClose={close}
        closeOnBlur={false}
      >
        <PopoverTrigger>
          <Button variant="primary">Popover Target</Button>
        </PopoverTrigger>
        <PopoverContent>
          <PopoverHeader>
            At least 8 characters consisting of:
          </PopoverHeader>
          <PopoverBody>
            <ul>
              <li>Alphanumeric characters (A-Z, a-z, 0-9) with both upper and lower case letters and number characters.</li>
              <li>At least one special character</li>
            </ul>
          </PopoverBody>
        </PopoverContent>
      </Popover>
    </>
  );
}
```

### Customization

#### Hide arrow

```jsx
<Popover
  hideArrow
>
  <PopoverTrigger>
    <Button>Trigger</Button>
  </PopoverTrigger>
  <PopoverContent>
    Popover
  </PopoverContent>
</Popover>
```

#### Offset position

```jsx
<Popover
  skidding={50}
  distance={0}
>
  <PopoverTrigger>
    <Button>Trigger</Button>
  </PopoverTrigger>
  <PopoverContent>
    Popover
  </PopoverContent>
</Popover>
```

### Hover Trigger

To show `Popover` when you mouse over or focus on the trigger, pass the prop `trigger` and set it to `hover`. When you focus on or mouse over the popover trigger, `Popover` will open.

If you quickly move your cursor to the popover content when it is open, `Popover` will remain open until you move away the cursor.

```jsx
<Popover
  hideArrow
  trigger="hover"
>
  <PopoverTrigger>
    <Icon icon="info" color="white:secondary" _hover={{ color: 'white:emphasis' }}/>
  </PopoverTrigger>
  <PopoverContent>
    Popover
  </PopoverContent>
</Popover>
```

### Mouse tracking

```jsx
<Stack shouldWrapChildren direction="row" spacing="2x">
  <Popover trigger="hover" nextToCursor>
    <PopoverTrigger>
      <Button>Next to cursor</Button>
    </PopoverTrigger>
    <PopoverContent>
      Popover
    </PopoverContent>
  </Popover>
  <Popover trigger="hover" followCursor>
    <PopoverTrigger>
      <Button>Follow cursor</Button>
    </PopoverTrigger>
    <PopoverContent>
      Popover
    </PopoverContent>
  </Popover>
</Stack>
```

### Popover Placement

Use the `placement` prop to control the placement of the popover.

```jsx disabled
<Popover placement="top">
  <PopoverTrigger>
    <LinkButton>Trigger</LinkButton>
  </PopoverTrigger>
  <PopoverContent>
    Popover
  </PopoverContent>
</Popover>
```

```jsx
<Box display="inline-block">
  <Grid
    templateColumns="repeat(3, minmax(84px,1fr))"
    templateRows="repeat(4, 84px)"
    gap="8x"
  >
    {['top-start', 'top', 'top-end',
      'right-start', 'right', 'right-end',
      'bottom-start', 'bottom', 'bottom-end',
      'left-start', 'left', 'left-end'
    ].map(placement => (
      <Popover
        key={placement}
        placement={placement}
        trigger="hover"
      >
        <PopoverTrigger>
          <Button width="100%">
            {placement}
          </Button>
        </PopoverTrigger>
        <PopoverContent>
          Popover
        </PopoverContent>
      </Popover>
    ))}
  </Grid>
</Box>
```

## Props

### Popover

| Name | Type | Default | Description |
| :--- | :--- | :------ | :---------- |
| arrowAt | string | | The position of the arrow. One of: 'left', 'right', 'top', 'bottom' |
| children | ReactNode \| (context) => ReactNode | | |
| closeOnBlur | boolean | true | If `true`, the popover will close when the user clicks outside of the popover. |
| closeOnEsc | boolean | true | If `true`, the popover will close when you press the `Esc` key. |
| defaultIsOpen | boolean | false | Whether the popover will be open by default. |
| distance | number | 4 | Displaces the popover (in pixels) away from, or toward, the reference. Used by [`popper.js`](https://popper.js.org/docs/v2/modifiers/offset/#distance-1) |
| enterDelay | number | 0 | The number of milliseconds to wait before showing the popover if `trigger` is hover. |
| followCursor | boolean | | If `true`, the popover will follow the cursor. |
| hideArrow | boolean | | If `true`, the arrow will not be displayed. |
| id | string | | The id of the popover. |
| initialFocusRef | React.Ref | | The reference of the element that will be focused when the popover opens. |
| isOpen | boolean | | If `true`, the popover will be open. |
| leaveDelay | number | 0 | The number of milliseconds to wait before hiding the popover if `trigger` is hover. |
| nextToCursor | boolean | | If `true`, the popover will be positioned next to the cursor. |
| onClose | () => void | | Callback when the popover is closed. |
| onOpen | () => void | | Callback when the popover is opened. |
| placement | string | 'bottom' | The placement of the popover. One of: 'top', 'bottom', 'right', 'left', 'top-start', 'top-end', 'bottom-start', 'bottom-end', 'right-start', 'right-end', 'left-start', 'left-end' |
| returnFocusOnClose | boolean | true | If `true`, the popover will return the focus status to the trigger when closing. |
| skidding | number | 0 | Displaces the popover (in pixels) away from, or toward, the reference. Used by [`popper.js`](https://popper.js.org/docs/v2/modifiers/offset/#distance-1) |
| trigger | string | 'click' | The type of trigger. One of: 'click', 'hover' |

### PopoverTrigger

| Name | Type | Default | Description |
| :--- | :--- | :------ | :---------- |
| children | ReactNode \| ({ getPopoverTriggerProps }) => ReactNode | | |

### PopoverContent

| Name | Type | Default | Description |
| :--- | :--- | :------ | :---------- |
| PopperComponent | ElementType | Popper | The component used for the popover. |
| PopperProps | object | | Props applied to the Popper component. |
| PopperArrowComponent | ElementType | PopperArrow | The component used for the popover arrow. |
| PopperArrowProps | object | | Props applied to the PopoverArrow component. |
| TransitionComponent | ElementType | Grow | The component used for the transition. |
| TransitionProps | object | | Props applied to the [Transition](http://reactcommunity.org/react-transition-group/transition#Transition-props) element. |
| TransitionProps.appear | boolean | true | |
| children | ReactNode | | |
| onBlur | (event: FocusEvent) => void | | A callback called when the popover loses focus. |
| onFocus | (event: FocusEvent) => void | | A callback called when the popover gains focus. |
| onKeyDown | (event: KeyboardEvent) => void | | A callback called when the popover is pressed with any key. |
| onMouseEnter | (event: MouseEvent) => void | | A callback called when the mouse enters the popover. |
| onMouseLeave | (event: MouseEvent) => void | | A callback called when the mouse leaves the popover. |

### PopoverHeader

| Name | Type | Default | Description |
| :--- | :--- | :------ | :---------- |
| children | ReactNode | | |

### PopoverBody

| Name | Type | Default | Description |
| :--- | :--- | :------ | :---------- |
| children | ReactNode | | |

### PopoverFooter

| Name | Type | Default | Description |
| :--- | :--- | :------ | :---------- |
| children | ReactNode | | |

## Accessibility

### Keyboard and focus

* When `Popover` is opened, the focus status is moved to `PopoverContent`. If `initialFocusRef` is set, then the focus status is moved to the element with the related reference (`ref`).

* When `Popover` is closed, the focus status returns to the trigger. If you set `returnFocusOnClose` to `false`, the focus status will not return.

* If `trigger` is set to `hover`:
  - Focusing on or mousing over the trigger will open `Popover`.
  - Blurring or mousing out of the trigger will close `Popover`. If you move your mouse into `PopoverContent`, `Popover` remains visible.

* If `trigger` is set to `click`:
  - Clicking the trigger or using the `Space` or `Enter` key when the focus status is on the trigger will open `Popover`.
  - Clicking the trigger again will close `Popover`.

* Hitting the `Esc` key while `Popover` is open and the focus status is within `PopoverContent` will close `Popover`. If you set `closeOnEsc` to `false`, `Popover` will not close.

* Clicking outside or blurring out of `PopoverContent` closes `Popover`. If you set `closeOnBlur` to `false`, `Popover` will not close.

### ARIA attributes

* If the `trigger` is set to `click`, the `role` of the `PopoverContent` element is set to `dialog`.

* If the `trigger` is set to `hover`, the `role` of the `PopoverContent` element is set to `tooltip`.

* `PopoverContent` has `aria-labelledby` set to the `id` attribute of `PopoverHeader`.

* `PopoverContent` has `aria-describedby` set to the `id` attribute of `PopoverBody`.

* `PopoverContent` has `aria-hidden` set to `true` or `false` depending on the open/closed state of `Popover`.

* The trigger has `aria-haspopup` set to `dialog` to denote the popup is a dialog.

* The trigger has `aria-controls` set to the `id` attribute of `PopoverContent` to associate the popover with the trigger.

* The trigger has `aria-expanded` set to `true` or `false` depending on the open/closed state of the popover.
